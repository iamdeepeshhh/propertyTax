<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>Assessment Register - Combined Header</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">
    <style>
        table {
          border-collapse: collapse;
          width: 100%;
          border: 1px solid #000; /* full outer border */
          table-layout: fixed;
        }

        th, td {
          border: 1px solid #000; /* uniform grid lines */
          text-align: center;
          padding: 4px 3px;
          vertical-align: middle;
          line-height: 1.1;
        }

        th {
          font-weight: 600;
          background: #f9f9f9;
        }

        /* vertical headers */
        .v {
          writing-mode: vertical-rl;
          transform: rotate(180deg);
          white-space: normal;
          word-break: break-word;
          font-size: 11px;
          line-height: 1.1;
          padding: 4px 2px;
          height: 100px;
          width: 30px;
          overflow: hidden;
        }

        th.p1, td.p1,
        th.p2, td.p2 {
          background: #fff;
          border: 1px solid #000; /* reinforce edge consistency */
        }

        /* Seam column (visual divider) */
        .seam, td.seam, th.seam {
          width: 12px;
          min-width: 12px;
          background: repeating-linear-gradient(
            90deg,
            #000 0 1px,
            transparent 1px 12px
          );
          border-left: 1px solid #000;
          border-right: 1px solid #000;
          padding: 0;
        }






        body {
          font-family: 'Noto Sans Devanagari', Arial, sans-serif;
          margin: 20px;
          font-size: 13px;
        }



        .controls {
          position: sticky;
          top: 0;
          background: #fff;
          padding: 10px;
          display: flex;
          gap: 10px;
          z-index: 10;
          border-bottom: 1px solid #ccc;
        }
        button {
          background: #004aad;
          color: #fff;
          border: none;
          padding: 8px 14px;
          border-radius: 6px;
          cursor: pointer;
        }
        button.secondary { background: #0e7c3a; }

        .report-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-left: -10px;
          padding: 10px 0;
        }
        .report-header img {
          height: 90px;
          width: auto;
          margin-left: 120px;
          border-radius: 20px;
          transform: scale(1.1);
        }
        .report-header div {
          flex-grow: 1;
          text-align: center;
          padding-left: 50px;
        }
        .report-header h1, .report-header p {
          margin: 0;
          padding: 0;
          font-size: 20px;
        }
        .report-header h1 {
          color: red;
          font-size: 22px;
        }

        tr.divider-row td {
          border-top: 2px double #000;
          border-bottom: none;
          background: #fff;
          height: 6px;
          padding: 0;
        }

        .column-numbers th {
          background: rgb(136, 214, 250);
          font-size: 11px;
          font-weight: bold;
          border: 1px solid #000;
          text-align: center;
        }

        /* printing */
        @media print {
          .controls { display: none !important; }
          header.report-header, thead {
            display: table-header-group;
          }
           body.print1 .p2, body.print1 .seam { display: none !important; }
          body.print2 .p1, body.print2 .seam { display: none !important; }
          tfoot { display: table-footer-group; }
          tr.page-break { page-break-after: always; }
        }



        @page { size: A3 landscape; margin: 1cm; }
    </style>
</head>
<body>
<div class="controls">
    <button onclick="printPart(1)">üñ®Ô∏è Print Part 1 (‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä ‡§Ü‡§ß‡•Ä‡§ö‡•á ‡§™‡§∞‡•ç‡§Ø‡§Ç‡§§)</button>
    <button class="secondary" onclick="printPart(2)">üñ®Ô∏è Print Part 2 (‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä ‡§®‡§Ç‡§§‡§∞‡§ö‡•á ‡§µ ‡§Ö‡§™‡•Ä‡§≤ ‡§®‡§Ç‡§§‡§∞)</button>
</div>

<!-- Main Header (first appearance) -->
<header class="report-header" id="mainHeader">
    <img class="councilLogo" src="https://example.com/default-image.png" alt="Council Logo">
    <div>
        <h1 class="councilName">‡§®‡§ó‡§∞ ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§, sitename / Nagar Panchayat sitename</h1>
        <p>(‡§®‡§Æ‡•Å‡§®‡§æ ‡•™‡•© ‡§®‡§ø‡§Ø‡§Æ ‡•≠‡•™ ‡§™‡§π‡§æ)/(Form No. 43 See Rule No. 74)</p>
        <p><span class="yearRange"></span> ‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§∑‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§á‡§Æ‡§æ‡§∞‡§§‡•Ä ‡§µ ‡§ú‡§Æ‡•Ä‡§® ‡§Ø‡§æ‡§Ç‡§ö‡•Ä ‡§Ü‡§ï‡§æ‡§∞‡§£‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</p>
    </div>
</header>

<!-- Placeholder container for chunks -->
<div id="reportContainer"></div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      const wardNo = new URLSearchParams(window.location.search).get("wardNo") || 1;
      const yearRange = document.querySelector(".yearRange");
      const currentYear = new Date().getFullYear();
      yearRange.textContent = `${currentYear - 1}-${currentYear}`;

      fetch(`/3g/secondaryBatchAssessmentReport?wardNo=${wardNo}`)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          if (!data || data.length === 0) {
            document.querySelector("#reportContainer").innerHTML =
              `<p style="text-align:center;">No records found for ward ${wardNo}</p>`;
            return;
          }
          renderAssessmentChunks(data);
        })
        .catch(err => {
          console.error("‚ùå Error fetching report:", err);
          document.querySelector("#reportContainer").innerHTML =
            `<p style="text-align:center;">Error loading report: ${err.message}</p>`;
        });
    });


    // üîπ Fetch council details and fill header
        function fetchCouncilDetails() {
          fetch('/3g/getCouncilDetails')
            .then(res => res.json())
            .then(data => {
              if (data && data.length > 0) {
                const c = data[0];
                document.querySelector('.councilName').textContent =
                  `${c.localName || '‡§®‡§ó‡§∞ ‡§™‡§∞‡§ø‡§∑‡§¶'} / ${c.standardName || 'Nagar Parishad'}`;
                if (c.imageBase64)
                  document.querySelector('.councilLogo').src = 'data:image/png;base64,' + c.imageBase64;
              }
            })
            .catch(err => console.error('‚ùå Failed to fetch council details:', err));
        }

        // ‚úÖ call it
        fetchCouncilDetails();



    /* --------------------------------------
       üîπ Render chunks (3 reports per page)
    -------------------------------------- */
    function renderAssessmentChunks(data) {
      const grouped = data.reduce((acc, prop) => {
        const key = prop.propertyDetails?.pdNewpropertynoVc;
        if (!acc[key]) acc[key] = [];
        acc[key].push(prop);
        return acc;
      }, {});

      const reportContainer = document.querySelector("#reportContainer");
      reportContainer.innerHTML = "";
      const groups = Object.values(grouped);

      // Header HTML to clone each time
      const councilHeaderHTML = document.querySelector("#mainHeader").outerHTML;
      const tableHeadHTML = `
        <thead>
          <tr>
            <th class="p1" rowspan="3">‡§ï‡•ç‡§∞.</th>
            <th class="p1" rowspan="3">‡§∞‡§∏‡•ç‡§§‡§æ,<br>‡§µ‡§ø‡§≠‡§æ‡§ó,<br>‡§Æ‡§Ç‡§°‡§≥‡§æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§µ ‡§µ‡§æ‡§° ‡§ï‡•ç‡§∞.</th>
            <th class="p1" rowspan="3">‡§ù‡•ã‡§® ‡§ï‡•ç‡§∞.<br>(‡§®‡§µ‡•Ä‡§® / ‡§ú‡•Å‡§®‡§æ)</th>
            <th class="p1" rowspan="3">‡§Æ‡§æ‡§≤‡§Æ‡§§‡•ç‡§§‡§æ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï<br>(‡§®‡§µ‡•Ä‡§® / ‡§ú‡•Å‡§®‡§æ / ‡§∏‡§π. ‡§Æ‡§æ. ‡§®‡§Ç.)</th>
            <th class="p1" rowspan="3">‡§Æ‡§æ‡§≤‡§ï‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</th>
            <th class="p1" rowspan="3">‡§≠‡•ã‡§ó‡§µ‡§ü‡§æ‡§¶‡§æ‡§∞‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</th>
            <th class="p1 group" colspan="3">‡§Æ‡§æ‡§≤‡§Æ‡§§‡•ç‡§§‡•á‡§ö‡•á ‡§µ‡§∞‡•ç‡§£‡§®</th>
            <th class="p1 v" rowspan="3">‡§Æ‡§æ‡§≤‡§Æ‡§§‡•ç‡§§‡•á‡§ö‡•á ‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§ø‡§§ ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§≠‡§æ‡§°‡•á ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th>
            <th class="p1 v" rowspan="3">‡§≠‡§æ‡§°‡•ç‡§Ø‡§æ‡§®‡•á ‡§¶‡§ø‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§ó‡§æ‡§ö‡•á ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§≠‡§æ‡§°‡•á</th>
            <th class="p1 v" rowspan="3">‡§≠‡§æ‡§°‡•ç‡§Ø‡§æ‡§®‡•á ‡§® ‡§¶‡§ø‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§ó‡§æ‡§ö‡•á ‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§ø‡§§ ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§≠‡§æ‡§°‡•á</th>
            <th class="p1 v" rowspan="3">‡§á‡§Æ‡§æ‡§∞‡§§‡•Ä‡§ö‡•á ‡§µ‡§æ ‡§ú‡§Æ‡§ø‡§®‡•Ä‡§ö‡•á ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§≠‡§æ‡§°‡•á</th>
            <th class="p1 v" rowspan="3">‡§¶‡•Å‡§∞‡•Å‡§∏‡•ç‡§§‡•Ä ‡§á‡§§‡•ç‡§Ø‡§æ‡§¶‡•Ä ‡§∏‡§æ‡§†‡•Ä 10% ‡§µ‡§ú‡§æ‡§µ‡§ü</th>
            <th class="p1 v" rowspan="3">‡§á‡§Æ‡§æ‡§∞‡§§‡•Ä‡§ö‡•á ‡§µ‡§æ ‡§ú‡§Æ‡§ø‡§®‡•Ä‡§ö‡•á ‡§ï‡§∞‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th>
            <th class="p1 group" colspan="9">‡§Ü‡§ï‡§æ‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ü‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§æ‡§Ç‡§ö‡•Ä ‡§∞‡§ï‡•ç‡§ï‡§Æ (‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä ‡§Ü‡§ß‡•Ä‡§ö‡•á)</th>
            <th class="seam" rowspan="3"></th>
            <th class="p2 group" colspan="9">‡§Ü‡§ï‡§æ‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ø‡•á‡§£‡§æ‡§±‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§æ‡§Ç‡§ö‡•Ä ‡§∞‡§ï‡•ç‡§ï‡§Æ (‡§Ü‡§ï‡•ç‡§∑‡•á‡§™ / ‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä ‡§®‡§Ç‡§§‡§∞‡§ö‡•á)</th>
            <th class="p2 group" colspan="9">‡§Ü‡§ï‡§æ‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ü‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§∞‡§ï‡§Æ (‡§Ö‡§™‡•Ä‡§≤ ‡§®‡§Ç‡§§‡§∞)</th>
            <th class="p2" rowspan="3">‡§Ü‡§ï‡•ç‡§∑‡•á‡§™‡§æ‡§¨‡§æ‡§¨‡§§</th>
            <th class="p2" rowspan="3">‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä ‡§®‡§ø‡§ï‡§æ‡§≤</th>
            <th class="p2" rowspan="3">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä‡§ö‡•Ä ‡§∏‡§π‡•Ä</th>
            <th class="p2" rowspan="3">‡§Ö‡§™‡•Ä‡§≤ ‡§∏‡§Æ‡§ø‡§§‡•Ä ‡§∏‡§≠‡§æ‡§™‡§§‡•Ä‡§ö‡•Ä ‡§∏‡§π‡•Ä</th>
            <th class="p2" rowspan="3">‡§´‡•á‡§∞‡§´‡§æ‡§∞ ‡§¨‡§Å‡§≤‡§ö‡§æ ‡§∂‡•á‡§∞‡§æ ‡§µ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡§æ‡§Ç‡§ö‡•Ä ‡§∏‡§π‡•Ä</th>
            <th class="p2 v" rowspan="3">‡§µ‡§æ‡§™‡§∞ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ / ‡§Æ‡§ú‡§≤‡§æ / ‡§Æ‡§æ‡§≤‡§ï, ‡§≠‡§æ‡§°‡•á‡§ï‡§∞‡•Ç</th>
          </tr>
          <tr>
            <th class="p1 v">‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ / ‡§Æ‡§ú‡§≤‡§æ / ‡§Æ‡§æ‡§≤‡§ï / ‡§≠‡§æ‡§°‡•á‡§ï‡§∞‡•Ç</th>
            <th class="p1 v">‡§¨‡§æ‡§Ç‡§ß‡§ï‡§æ‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ / ‡§ï‡§∞‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§´‡§≥</th>
            <th class="p1 v">‡§è‡§ï‡•Ç‡§£ ‡§ï‡§∞‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§´‡§≥</th>
            <th class="p1">‡§ï‡§∞‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th><th class="p1">‡§Æ‡§æ‡§≤‡§Æ‡§§‡•ç‡§§‡§æ ‡§ï‡§∞</th>
            <th class="p1 v">‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ ‡§ï‡§∞</th><th class="p1 v">‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§ï‡§∞</th>
            <th class="p1 v">‡§Ö‡§ó‡•ç‡§®‡§ø‡§∂‡§Æ‡§® ‡§ï‡§∞</th><th class="p1 v">‡§ù‡§æ‡§° ‡§ï‡§∞</th>
            <th class="p1 v">‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞</th><th class="p1 v">‡§∞‡•ã‡§ú‡§ó‡§æ‡§∞ ‡§π‡§Æ‡•Ä ‡§∏‡•á‡§∏</th>
            <th class="p1">‡§è‡§ï‡•Ç‡§£</th>
            <th class="p2">‡§ï‡§∞‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th><th class="p2">‡§Æ‡§æ‡§≤‡§Æ‡§§‡•ç‡§§‡§æ ‡§ï‡§∞</th>
            <th class="p2 v">‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ ‡§ï‡§∞</th><th class="p2 v">‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§ï‡§∞</th>
            <th class="p2 v">‡§Ö‡§ó‡•ç‡§®‡§ø‡§∂‡§Æ‡§® ‡§ï‡§∞</th><th class="p2 v">‡§ù‡§æ‡§° ‡§ï‡§∞</th>
            <th class="p2 v">‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞</th><th class="p2 v">‡§∞‡•ã‡§ú‡§ó‡§æ‡§∞ ‡§π‡§Æ‡•Ä ‡§∏‡•á‡§∏</th>
            <th class="p2">‡§è‡§ï‡•Ç‡§£</th>
            <th class="p2">‡§ï‡§∞‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</th><th class="p2">‡§Æ‡§æ‡§≤‡§Æ‡§§‡•ç‡§§‡§æ ‡§ï‡§∞</th>
            <th class="p2 v">‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ ‡§ï‡§∞</th><th class="p2 v">‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§ï‡§∞</th>
            <th class="p2 v">‡§Ö‡§ó‡•ç‡§®‡§ø‡§∂‡§Æ‡§® ‡§ï‡§∞</th><th class="p2 v">‡§ù‡§æ‡§° ‡§ï‡§∞</th>
            <th class="p2 v">‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞</th><th class="p2 v">‡§∞‡•ã‡§ú‡§ó‡§æ‡§∞ ‡§π‡§Æ‡•Ä ‡§∏‡•á‡§∏</th>
            <th class="p2">‡§è‡§ï‡•Ç‡§£</th>
          </tr>

        </thead>
        <tr class="column-numbers">
            <th >1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
            <th>16</th>
            <th>17</th>
            <th>18</th>
            <th>19</th>
            <th>20</th>
            <th>21</th>
            <th>22</th>
            <th>23</th>
            <th>24</th>
            <th></th>
            <th class="p2" >25</th>
            <th class="p2">26</th>
            <th class="p2">27</th>
            <th class="p2">28</th>
            <th class="p2">29</th>
            <th class="p2">30</th>
            <th class="p2">31</th>
            <th class="p2">32</th>
            <th class="p2">33</th>
            <th class="p2">34</th>
            <th class="p2">35</th>
            <th class="p2">36</th>
            <th class="p2">37</th>
            <th class="p2">38</th>
            <th class="p2">39</th>
            <th class="p2">40</th>
            <th class="p2">41</th>
            <th class="p2">42</th>
            <th class="p2">43</th>
            <th class="p2">44</th>
            <th class="p2"">45</th>
            <th class="p2">46</th>
            <th class="p2">47</th>
            <th class="p2">48</th>
          </tr>
        `;

      let chunkIndex = 0;
      for (let i = 0; i < groups.length; i += 3) {
        chunkIndex++;
        const chunk = groups.slice(i, i + 3);
        const wrapper = document.createElement("div");

        // only add council header from 2nd chunk onwards
        wrapper.innerHTML = `
          ${chunkIndex === 1 ? "" : councilHeaderHTML}
          <table class="reportTable">${tableHeadHTML}<tbody></tbody></table>
        `;
        const tbody = wrapper.querySelector("tbody");

        chunk.forEach((group, idx) => {
          const property = group[0];
          const pd = property.propertyDetails || {};
          const usages = (group.flatMap(p => p.propertyUnitDetails || [])).map(u => u.usageTypeVc || "").join("<br>");
          const beforeAll = group.map(p => p.taxKeyValueMapAfterAssess || {});
          const afterAll = group.map(p => p.taxKeyValueMapAfterHearing || {});
          const mergeTaxMaps = (arr) => {
            const total = {};
            arr.forEach(m => {
              for (const [k, v] of Object.entries(m)) {
                total[k] = (total[k] || 0) + (parseFloat(v) || 0);
              }
            });
            return total;
          };
          const before = mergeTaxMaps(beforeAll);
          const after = mergeTaxMaps(afterAll);
          const totalBefore = Object.values(before).reduce((a,b)=>a+b,0);
          const totalAfter = Object.values(after).reduce((a,b)=>a+b,0);

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="p1">${i + idx + 1}</td>
            <td class="p1">${pd.pdWardI || ""}</td>
            <td class="p1">${pd.pdZoneI || ""}</td>
            <td class="p1">${pd.pdNewpropertynoVc || ""}<br>${pd.pdFinalpropnoVc || ""}</td>
            <td class="p1">${pd.pdOwnernameVc || "‚Äî"}</td>
            <td class="p1">${pd.pdOccupinameF || "‚Äî"}</td>
            <td class="p1">${usages}</td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1">${before["ratepersqm"] || ""}</td>
            <td class="p1">${before["actualrent"] || ""}</td>
            <td class="p1">${before["ratablevalue"] || ""}</td>
            <td class="p1">${before["amountafterdep"] || ""}</td>
            <td class="p1">${before["depamount"] || ""}</td>
            <td class="p1">${before["totalratablevalue"] || ""}</td>
            <td class="p1">${before["1"] || 0}</td>
            <td class="p1">${before["3"] || 0}</td>
            <td class="p1">${before["4"] || 0}</td>
            <td class="p1">${before["5"] || 0}</td>
            <td class="p1">${before["6"] || 0}</td>
            <td class="p1">${before["7"] || 0}</td>
            <td class="p1">${before["27"] || 0}</td>
            <td class="p1">${before["46"] || 0}</td>
            <td class="p1"><b>${totalBefore.toFixed(0)}</b></td>
            <td class="seam"></td>
            <td class="p2">${after["taxableValueConsideredFl"] || ""}</td>
            <td class="p2">${after["1"] || 0}</td>
            <td class="p2">${after["3"] || 0}</td>
            <td class="p2">${after["4"] || 0}</td>
            <td class="p2">${after["5"] || 0}</td>
            <td class="p2">${after["6"] || 0}</td>
            <td class="p2">${after["7"] || 0}</td>
            <td class="p2">${after["27"] || 0}</td>
            <td class="p2">${after["46"] || 0}</td>
            <td class="p2"><b>${totalAfter.toFixed(0)}</b></td>
            <td class="p2">‚Äî</td>
            <td class="p2">‚Äî</td>
            <td class="p2">‚úîÔ∏è</td>
            <td class="p2">‚úîÔ∏è</td>
            <td class="p2">‚úîÔ∏è</td>
            <td class="p2">${usages}</td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>`
            ;
          tbody.appendChild(tr);

          const tr1 = document.createElement("tr");
          tr1.innerHTML = `
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="seam"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>`
            ;
          tbody.appendChild(tr1);

           const tr2 = document.createElement("tr");
          tr2.innerHTML = `
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="p1"></td>
            <td class="seam"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>
            <td class="p2"></td>`
            ;
          tbody.appendChild(tr2);


<!--        for (let d = 0; d < 2; d++) {-->
<!--          const emptyRow = document.createElement("tr");-->
<!--          emptyRow.classList.add("divider-row");-->

<!--          // Collect only .p1 and .p2 columns (ignore seam)-->
<!--          const cols = Array.from(tr.children).filter(td =>-->
<!--            td.classList.contains('p1') || td.classList.contains('p2')-->
<!--          );-->

<!--          // Create empty cells for each column-->
<!--          cols.forEach(() => {-->
<!--            const td = document.createElement("td");-->
<!--            td.innerHTML = "&nbsp;"; // blank cell-->
<!--            emptyRow.appendChild(td);-->
<!--          });-->

<!--          tbody.appendChild(emptyRow);-->
<!--        }-->


           // Page break style after each chunk
        wrapper.style.pageBreakAfter = "always";
        reportContainer.appendChild(wrapper);


        });



      }
    }

    /* print logic */
    function printPart(part) {
      document.body.classList.remove('print1','print2');
      document.body.classList.add(part === 1 ? 'print1' : 'print2');
      window.print();
      setTimeout(() => document.body.classList.remove('print1','print2'), 400);
    }
</script>
</body>
</html>